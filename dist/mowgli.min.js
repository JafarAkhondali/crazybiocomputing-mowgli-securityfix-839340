/*! mowgli 2015-12-30 */
function Bond(a,b){this.type=Bond.NONE,this.atom1=a,this.atom2=b,this.middle={x:(this.atom1.x+this.atom2.x)/2,y:(this.atom1.y+this.atom2.y)/2,z:(this.atom1.z+this.atom2.z)/2}}function BondCalculator(a){function b(a){var b=5;g=Math.round((a.bbox.max.x-a.bbox.min.x)/b),h=Math.round((a.bbox.max.y-a.bbox.min.y)/b),i=Math.round((a.bbox.max.z-a.bbox.min.z)/b);for(var c in a.atoms){var d=a.atoms[c],e=Math.floor((d.x-a.bbox.min.x)/b),j=Math.floor((d.y-a.bbox.min.y)/b),k=Math.floor((d.z-a.bbox.min.z)/b),l=e+j*g+k*g*h;void 0==f[l]&&(f[l]={key:l,atoms:[]}),f[l].atoms.push(d)}}function c(a){console.log("calcAllBonds");for(var b in f)for(var c=f[b],e=-1;1>=e;e++)for(var i=-1;1>=i;i++)for(var m=-1;1>=m;m++){var n=f[b].key+m+i*g+e*g*h;void 0!=f[n]&&d(c,f[n])}console.log("covalent bonds .... "+j.length),console.log("hydrogen bonds .... "+k.length),console.log("disulfide bonds ... "+l.length),a.bonds=j,a.hBonds=k,a.ssBonds=l}function d(a,b){for(var c in a.atoms){var d=a.atoms[c];for(var f in b.atoms){var g=b.atoms[f];if(d.serial<g.serial){var h=e(d,g);switch(h){case Bond.COVALENT:var i=new Bond(d,g);j.push(i);break;case Bond.HBOND:var i=new Bond(d,g);k.push(i);break;case Bond.SSBOND:var i=new Bond(d,g);l.push(i)}}}}}function e(a,b){var c=.25,d=3.61,e=2.2*2.2,f=12.25,g=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)+(b.z-a.z)*(b.z-a.z);return"SG"===a.name&&"SG"===b.name&&e>g?Bond.SSBOND:g>c&&d>g?Bond.COVALENT:"O"===a.name&&"N"===b.name&&f>g||"N"===a.name&&"O"===b.name&&f>g||"C"===a.name&&"O"===b.name&&f>g||"O"===a.name&&"C"===b.name&&f>g?Bond.HBOND:Bond.NONE}var f={},g=0,h=0,i=0,j=[],k=[],l=[];b(a),c(a)}function Attribute(a,b,c){this.name=a,this.offset=b,this.stride=c,this.size=-1,this.location=-1}function Camera(){this.ID="camera",this.projMatrix=mat4.create(),this.viewMatrix=mat4.create(),mat4.identity(this.viewMatrix),this.fovy=45*Math.PI/180,this.zoom=1}function Geometry(a){console.log(a),this.type=a.type||"none",this.data=a.data,this.attributes=a.attributes,this.indices=a.indices,"indexed"===this.type?this._isIndexed=!0:this._isIndexed=!1,console.log("end create GEOM"),console.log(this.attributes)}function Light(){this.ID="light"}function Renderer(a){function b(a,b){var c=["webgl","experimental-webgl"],d=null;for(var e in c){try{d=a.getContext(c[e],b)}catch(f){}if(d)break}return d}this.scene=null;var c=document.getElementById(a);this.context=b(c),this.context&&(this.context.viewportWidth=c.width,this.context.viewportHeight=c.height,this.shaders={},this.shaderProgram=null,this._initGL())}function Shape(){this.ID="shape",this.colorMode="monochrome",this.shaderProgram=null,this.geometries=[],this.colors=null,this.type="POINTS",this.glType=0,this.numItems=0,this.numIndices=0,this.cg={x:0,y:0,z:0},this._isIndexed=!1,this.matrix=mat4.create(),mat4.identity(this.matrix)}function MMCIFParser(){}function PDBMLParser(){}function XYZParser(){this.mol=new Structure}function Wireframe(){}function Console(){}function EventManager(){}function MouseSensor(a){var b=[0,0],c=[0,0],d=-1,e=-1,f=!1,g=document.getElementById(a),h=[],i=null;return g.onmousedown=function(a){var c=a.clientX,h=a.clientY,i=a.target.getBoundingClientRect();i.left<=c&&c<=i.right&&i.top<=h&&h<=i.bottom&&(d=c,e=h,b[0]=c,b[1]=g.height-h,f=!0)},g.onmouseup=function(a){f=!1},g.onmousemove=function(a){var j=a.clientX,k=a.clientY;if(f){var l=.05,m=l*(j-d),n=l*(k-e);c[0]=Math.max(Math.min(c[0]+n,90),-90),c[1]=c[1]+m,b[0]=j,b[1]=g.height-k,console.log(c[0]+" "+c[1]);var o=mat4.create();mat4.identity(o),mat4.rotate(o,o,m,[0,1,0]),mat4.rotate(o,o,n,[1,0,0]);for(var p in h)mat4.multiply(h[p].matrix,o,h[p].matrix);i.drawScene()}d=j,e=k},{attach:function(a){h.push(a)},setRenderer:function(a){i=a}}}var StructureReader=function(){};StructureReader.prototype.getFromDOM=function(a,b){var c=document.getElementById(a).innerHTML,d=this.createStructure(c,b);return d},StructureReader.prototype.getFromURL=function(a){var b=a.substr(a.length-3,a.length-1);console.log(b),window.XMLHttpRequest?request=new XMLHttpRequest:alert("Please update your browser");try{request.open("GET",a,!1),request.send()}catch(c){alert(c.description)}var d=this.createStructure(request.responseText,b);return d},StructureReader.prototype.getFromID=function(a){return this.getFromURL("http://www.rcsb.org/pdb/files/"+a+".pdb")},StructureReader.prototype.createStructure=function(a,b){var c=null;"pdb"===b?c=new PDBParser:"cif"===b?c=new MMCIFParser:"xml"===b?c=new PDBMLParser:"xyz"===b&&(c=new XYZParser),c.parse(a);var d=c.getStructure();return this.computeBonds(d),d},StructureReader.prototype.computeBonds=function(a){},Bond.NONE=0,Bond.COVALENT=1,Bond.SSBOND=2,Bond.HBOND=4,Camera.prototype.setFovy=function(a){this.fovy=a*Math.PI/180},Camera.prototype.setViewport=function(a,b){mat4.perspective(this.projMatrix,this.fovy*this.zoom,a/b,.1,1e3)},Geometry.prototype.getBuffer=function(a){for(var b=!1,c=0;!b&&c<this.VBO.length;){if(this.VBO[c].type===a)return this.VBO[c];c++}return null},Geometry.prototype.isIndexed=function(){return this._isIndexed};var Program=function(a,b){this.ctx=a,this.name=b,this.vertex_shader=null,this.fragment_shader=null,this.shaderProgram=0,this.attributes=[],this.uniforms=[],this.attribLocation={},this.uniformLocation={}};Program.prototype.getID=function(){return this.shaderProgram},Program.prototype.load=function(a,b){"vertex"==a?console.log("vertex"):"fragment"==a?console.log("fragment"):alert("Unknown shader type")},Program.prototype.loadHTTP=function(a,b){var c="shaders/"+b+"."+a,d=new XMLHttpRequest;d.open("GET",c,!0),d.responseType="text",d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(this.fragment_shader=this._compile(gl.FRAGMENT_SHADER,this.response))},d.send()},Program.prototype.loadDOM=function(a,b){var c=this.ctx,d=document.getElementById(b);if(!d)return null;for(var e="",f=d.firstChild;f;)3==f.nodeType&&(e+=f.textContent),f=f.nextSibling;if("x-shader/x-fragment"==d.type)this.fragment_shader=this._compile(c.FRAGMENT_SHADER,e);else{if("x-shader/x-vertex"!=d.type)return null;this.vertex_shader=this._compile(c.VERTEX_SHADER,e)}this._createAttributesAndUniforms(e)},Program.prototype.link=function(){var a=this.ctx;this.shaderProgram=a.createProgram(),a.attachShader(this.shaderProgram,this.vertex_shader),a.attachShader(this.shaderProgram,this.fragment_shader),a.linkProgram(this.shaderProgram),a.getProgramParameter(this.shaderProgram,a.LINK_STATUS)||alert("Could not initialise shaders")},Program.prototype.use=function(){var a=this.ctx;a.useProgram(this.shaderProgram)},Program.prototype.getAttribLocation=function(a){var b=this.ctx;return b.useProgram(this.getID()),b.getAttribLocation(this.getID(),a)},Program.prototype.setUniformLocation=function(a){var b=this.ctx;b.useProgram(this.getID()),this.uniformLocation[a]=b.getUniformLocation(this.getID(),a)},Program.prototype.getUniformLocation=function(a){this.ctx;return this.uniformLocation[a]},Program.prototype._compile=function(a,b){var c=this.ctx,d=c.createShader(a);return c.shaderSource(d,b),c.compileShader(d),c.getShaderParameter(d,c.COMPILE_STATUS)?d:(alert(c.getShaderInfoLog(d)),null)},Program.prototype._createAttributesAndUniforms=function(a){var b,c=a.split("\n"),d=/[\s,;]+/,e="x";for(var f in c){var g=c[f];if(-1!=g.indexOf("attribute")||-1!=g.indexOf("uniform")){words=g.trim().split(d),console.log(words);for(var h=0;h<words.length;h++)switch(words[h]){case"//":h=words.length;break;case"attribute":e="a";break;case"uniform":e="u";break;case"bool":itemSize=1,b=words[h];break;case"int":itemSize=1,b=words[h];break;case"float":itemSize=1,b=words[h];break;case"vec2":itemSize=2,b=words[h];break;case"vec3":itemSize=3,b=words[h];break;case"vec4":itemSize=4,b=words[h];break;case"mat4":itemSize=16,b=words[h];break;default:"a"==e&&""!=words[h]?(console.log("attribute "+words[h]+" type "+b),this.attributes[words[h]]={name:words[h],type:b,size:itemSize}):"u"==e&&""!=words[h]&&(console.log("uniform "+words[h]+" type "+b),this.uniforms[words[h]]={name:words[h],type:b,size:itemSize})}}}},Renderer.prototype.getContext=function(){return this.context},Renderer.prototype.addScene=function(a){this.scene=a},Renderer.prototype.addSensor=function(a){this.sensor=a,this.sensor.setRenderer(this)},Renderer.prototype.drawScene=function(){var a=this.context;a.viewport(0,0,a.viewportWidth,a.viewportHeight),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var b=this.scene.children.camera;b.setViewport(a.viewportWidth,a.viewportHeight);for(var c in this.scene.children){var d=this.scene.children[c];if(d instanceof Shape){var e=d.shaderProgram;console.log(d.shaderProgram),e.use(),a.uniformMatrix4fv(e.getUniformLocation("uPMatrix"),!1,b.projMatrix),a.uniformMatrix4fv(e.getUniformLocation("uVMatrix"),!1,b.viewMatrix),a.uniformMatrix4fv(e.getUniformLocation("uMMatrix"),!1,d.matrix),console.log("coordSize "+d.numItems);for(var f in d.geometries){var g=d.geometries[f];"indexed"===g.type?(console.log("bind buffer "+g.type+" "+g.ID+" "+g.data),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g.IndxID)):(console.log("bind buffer "+g.type+" "+g.ID),a.bindBuffer(a.ARRAY_BUFFER,g.ID));for(var h in g.attributes){var i=g.attributes[h];console.log("enable "+i.name+" "+i.location+" "+i.size+" "+i.stride+" "+i.offset),a.enableVertexAttribArray(i.location),a.vertexAttribPointer(i.location,i.size,a.FLOAT,!1,i.stride*Renderer.FLOAT_IN_BYTES,i.offset*Renderer.FLOAT_IN_BYTES)}}console.log(d.type+" "+d.glType+" "+d.numIndices+" "+d.numItems),d.isIndexedGeometry()?a.drawElements(d.glType,d.numIndices,a.UNSIGNED_SHORT,0):(console.log("drawArrays"),a.drawArrays(d.glType,0,d.numItems))}}},Renderer.prototype.update=function(){this.context},Renderer.FLOAT_IN_BYTES=4,Renderer.prototype._initGL=function(){var a=this.context;a.clearColor(.1,.1,.1,1),a.enable(a.DEPTH_TEST),a.getExtension("EXT_frag_depth"),a.getSupportedExtensions().indexOf("EXT_frag_depth")<0&&alert("Extension frag_depth not supported"),this.program=new Program};var Scene=function(){this.ID="scene",this.children={},this.children.camera=new Camera,this.children.light=new Light};Scene.prototype.add=function(a){this.children[a.ID+"_"+this.children.length]=a},Scene.prototype.getCamera=function(){return this.children.camera},Scene.prototype.toString=function(){return JSON.stringify(this.children)},Shape.prototype.setColorMode=function(a){},Shape.prototype.setProgram=function(a){console.log(a),this.shaderProgram=a},Shape.prototype.isIndexedGeometry=function(){return this._isIndexed},Shape.prototype.setInterleavedGeometry=function(a,b){},Shape.prototype.setGeometry=function(a){this.type=a.type||"POINTS",void 0!=a.indices?(this._isIndexed=!0,this.geometries.push(new Geometry({type:"indexed",data:new Float32Array(a.data),indices:new Uint16Array(a.indices),attributes:a.attributes})),this.numIndices=a.indices.length):this.geometries.push(new Geometry({type:"vertex",data:new Float32Array(a.data),attributes:a.attributes}))},Shape.prototype.setCG=function(a){this.cg=a},Shape.prototype.setColors=function(a){var b=0;switch(a.type){case"RGB":b=3;break;case"RGBA":b=4}this.geometries.push({type:"color",data:new Float32Array(a.data),attributes:a.attributes})},Shape.prototype.updateGL=function(a){for(var b in this.geometries)this.geometries[b]=this._createVBO(a,this.geometries[b]);this.isDirty=!1},Shape.prototype.updateUniforms=function(a){},Shape.prototype._createVBO=function(a,b){var c=a;switch(console.log("SHAPE TYPE "+this.type),this.type){case"POINTS_RADIUS":this.glType=c.POINTS;break;case"LINES":this.glType=c.LINES;break;case"LINE_STRIP":this.glType=c.LINE_STRIP;break;case"LINE_LOOP":this.glType=c.LINE_LOOP;break;case"TRIANGLES":this.glType=c.TRIANGLES;break;case"TRIANGLE_STRIP":this.glType=c.TRIANGLE_STRIP}b.ID=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,b.ID),c.bufferData(c.ARRAY_BUFFER,b.data,c.STATIC_DRAW),console.log("VBO attributes"),console.log(b.attributes);for(var d=0;d<b.attributes.length;d++)b.attributes[d].location=this.shaderProgram.getAttribLocation(b.attributes[d].name),b.attributes[d].size=this.shaderProgram.attributes[b.attributes[d].name].size,console.log("location ["+b.attributes[d].name+"]= "+b.attributes[d].location+" "+b.attributes[d].size);return"indexed"===b.type&&(b.IndxID=c.createBuffer(),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,b.IndxID),c.bufferData(c.ELEMENT_ARRAY_BUFFER,b.indices,c.STATIC_DRAW)),console.log("VBO ID: "+b.ID),b},Shape.prototype._updateAttributes=function(a){for(var b=0;b<this.geometry.VBO.length;b++)for(var c=this.geometry.VBO[b],d=0;d<c.attributes.length;d++)c.attributes[d].location=this.shaderProgram.getAttribLocation(c.attributes[d].name),c.attributes[d].size=this.shaderProgram.attributes[c.attributes[d].name].size,console.log("location ["+c.attributes[d].name+"]= "+c.attributes[d].location+" "+c.attributes[d].size)};var ShapeFactory=function(){return{get:function(a){switch(a.style){case"points":var b=new PointStyle(a);return b.getShape();case"backbone":break;case"ball_sticks":break;case"cartoon":break;case"dots":break;case"spacefill":break;case"ribbons":break;case"sticks":break;case"strands":break;case"trace":break;case"wireframe":break;default:return null}}}}(),Cube=function(){Shape.call(this),this.ID="cube"};Cube.prototype=Object.create(Shape.prototype),Cube.prototype.setStyle=function(a){switch(a){case"wireframe":this.ID="cubeWire";var b=[0,1,2,3,0,4,5,6,7,4,5,1,2,6,7,3];this.setGeometry({type:"LINE_STRIP",data:Cube.vertices,indices:b,attributes:[new Attribute("aVertexPosition",0,0)]}),this.numItems=Cube.vertices.length/3;break;case"solid":this.ID="cubeSolid";break;case"shaded":this.ID="cubeShaded";break;case"textured":this.ID="cubeTextured"}},Cube.vertices=[1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,1,-1,1,1];var MowgliViewer=function(a){this.renderer=new Renderer(a),this.scene=new Scene,this.renderer.addScene(scene),this.renderer.update();var b=new MouseSensor(a);this.mouse.attach(this.scene),this.renderer.addSensor(b)};MowgliViewer.prototype.getScene=function(){return this.scene},MowgliViewer.prototype.render=function(){this.renderer.drawScene()};var PDBParser=function(){this.mol=new Structure,this.secondary=[],this.cubes=[],this.cube_side=5};PDBParser.TAGS={ANISOU:0,ATOM:1,AUTHOR:2,CAVEAT:3,CISPEP:4,COMPND:5,CONECT:6,CRYST1:7,DBREF1:8,DBREF2:9,DBREF:10,END:11,ENDMDL:12,EXPDTA:13,FORMUL:14,HEADER:15,HELIX:16,HET:17,HETATM:18,HETNAM:19,HETSYN:20,JRNL:21,KEYWDS:22,LINK:23,MASTER:24,MDLTYP:25,MODEL:26,MODRES:27,MTRIX1:28,MTRIX2:29,MTRIX3:30,NUMMDL:31,OBSLTE:32,ORIGX1:33,ORIGX2:34,ORIGX3:35,REMARK:36,REVDAT:37,SCALE1:38,SCALE2:39,SCALE3:40,SEQADV:41,SEQRES:42,SHEET:43,SITE:44,SOURCE:45,SPLT:46,SPRSDE:47,SSBOND:48,TER:49,TITLE:50},PDBParser.prototype.getStructure=function(){return this.mol},PDBParser.prototype.parse=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++)if(b[c].length>2){var d=PDBParser.TAGS[b[c].substring(0,6).trim()];switch(d){case PDBParser.TAGS.ATOM:case PDBParser.TAGS.HETATM:this.parseAtom(b[c]);break;case PDBParser.TAGS.END:this.postProcess();break;case PDBParser.TAGS.HEADER:this.parseHeader(b[c]);break;case PDBParser.TAGS.HELIX:this.parseHelix(b[c]);break;case PDBParser.TAGS.SHEET:console.log("parse sheet"),this.parseSheet(b[c]);break;case PDBParser.TAGS.TITLE:this.parseTitle(b[c])}}this.mol.cg.x/=this.mol.atoms.length,this.mol.cg.y/=this.mol.atoms.length,this.mol.cg.z/=this.mol.atoms.length,mat4.translate(this.mol.matrix,this.mol.matrix,[-this.mol.cg.x,-this.mol.cg.y,-this.mol.cg.z]),this.mol.bbox.center.x=(this.mol.bbox.min.x+this.mol.bbox.max.x)/2,this.mol.bbox.center.y=(this.mol.bbox.min.y+this.mol.bbox.max.y)/2,this.mol.bbox.center.z=(this.mol.bbox.min.z+this.mol.bbox.max.z)/2,this.mol.bbox.radius=(this.mol.bbox.min.x-this.mol.bbox.max.x)*(this.mol.bbox.min.x-this.mol.bbox.max.x)+(this.mol.bbox.min.y-this.mol.bbox.max.y)*(this.mol.bbox.min.y-this.mol.bbox.max.y)+(this.mol.bbox.min.z-this.mol.bbox.max.z)*(this.mol.bbox.min.z-this.mol.bbox.max.z),this.mol.bbox.radius=Math.sqrt(this.mol.bbox.radius)/2,console.log("cg "+this.mol.cg.x+" "+this.mol.cg.y+" "+this.mol.cg.z),console.log(this.mol.atoms.length+" "+this.mol.bbox.radius+" "+this.mol.bbox.center.x+" "+this.mol.bbox.center.y+" "+this.mol.bbox.center.z)},PDBParser.prototype.parseHeader=function(a){this.mol.classification=a.substring(10,50).trim(),this.mol.date=a.substring(50,59).trim(),this.mol.ID=a.substring(62,66).trim()},PDBParser.prototype.parseAtom=function(a){var b={};b.type=a.substring(0,6).trim(),b.serial=parseInt(a.substring(6,11)),b.name=a.substring(12,16).trim(),b.altLoc=a[16],b.group=a.substring(17,20).trim(),b.chain=a[21],b.groupID=parseInt(a.substring(22,26)),b.x=parseFloat(a.substring(30,38)),b.y=parseFloat(a.substring(38,46)),b.z=parseFloat(a.substring(46,54)),b.symbol=a.substring(76,78).trim(),b.secondary="X";for(var c=0;c<this.secondary.length;)this.secondary[c].initChain===b.chain&&b.groupID>=this.secondary[c].init&&b.groupID<=this.secondary[c].end&&(b.secondary=this.secondary[c].type+"_"+this.secondary[c].strand+"["+this.secondary[c].serial+";"+this.secondary[c].ID+"]",c=this.secondary.length),c++;this.mol.atoms.push(b),-1==this.mol.chains.indexOf(b.chain)&&this.mol.chains.push(b.chain),this.mol.cg.x+=b.x,this.mol.cg.y+=b.y,this.mol.cg.z+=b.z,this.updateBBox(b)},PDBParser.prototype.parseHelix=function(a){this.secondary.push({type:"H",serial:parseInt(a.substring(7,10)),ID:a.substring(11,14),strand:"",initChain:a[19],init:parseInt(a.substring(21,25)),endChain:a[31],end:parseInt(a.substring(33,37)),"class":Structure.RIGHT_HANDED_ALPHA||parseInt(a.substring(38,40))})},PDBParser.prototype.parseSheet=function(a){this.secondary.push({type:"E",serial:"E",ID:a.substring(11,14),strand:parseInt(a.substring(7,10)),initChain:a[21],init:parseInt(a.substring(22,26)),endChain:a[32],end:parseInt(a.substring(33,37)),sense:parseInt(a.substring(38,40))})},PDBParser.prototype.parseTitle=function(a){1==parseInt(a.substring(8,10).trim())?this.mol.title=a.substring(10,80).trim():this.mol.title=" "+a.substring(10,80).trim()},PDBParser.prototype.updateBBox=function(a){this.mol.bbox.min.x>a.x&&(this.mol.bbox.min.x=a.x),this.mol.bbox.min.y>a.y&&(this.mol.bbox.min.y=a.y),this.mol.bbox.min.z>a.z&&(this.mol.bbox.min.z=a.z),this.mol.bbox.max.x<a.x&&(this.mol.bbox.max.x=a.x),this.mol.bbox.max.y<a.y&&(this.mol.bbox.max.y=a.y),this.mol.bbox.max.z<a.z&&(this.mol.bbox.max.z=a.z)},PDBParser.prototype.postProcess=function(){console.log("PostProcess");new BondCalculator(this.mol)},XYZParser.prototype.getStructure=function(){return this.mol},XYZParser.prototype.parse=function(a){var b=a.split("\n");console.log(b);for(var c=0;0==/^\d+$/.test(b[c]);)c++;this.mol.title=b[c+1];for(var d=c+2;d<b.length;d++)void 0!==b[d]&&b[d].length>0&&this.parseAtom(b[d],d-1-c)},XYZParser.prototype.parseAtom=function(a,b){var c=a.match(/(\S+)/g);console.log(c);var d={};d.type="ATOM",d.serial=b,d.name=c[0].trim(),d.group="XXX",d.chain="A",d.groupID=1,d.x=parseFloat(c[1].trim()),d.y=parseFloat(c[2].trim()),d.z=parseFloat(c[3].trim()),d.symbol=d.name,d.secondary="X",this.mol.atoms.push(d),this.mol.cg.x+=d.x,this.mol.cg.y+=d.y,this.mol.cg.z+=d.z,this.updateBBox(d)},XYZParser.prototype.updateBBox=function(a){this.mol.bbox.min.x>a.x&&(this.mol.bbox.min.x=a.x),this.mol.bbox.min.y>a.y&&(this.mol.bbox.min.y=a.y),this.mol.bbox.min.z>a.z&&(this.mol.bbox.min.z=a.z),this.mol.bbox.max.x<a.x&&(this.mol.bbox.max.x=a.x),this.mol.bbox.max.y<a.y&&(this.mol.bbox.max.y=a.y),this.mol.bbox.max.z<a.z&&(this.mol.bbox.max.z=a.z)};var Structure=function(){this.ID="0UNK",this.classification="Unknown",this.title="No Title",this.date="00-UNK-00",this.atoms=[],this.bonds=[],this.colors=[],this.chains=[],this.cg={x:0,y:0,z:0},this.matrix=mat4.create(),mat4.identity(this.matrix),this.bbox={min:{x:Number.MAX_VALUE,y:Number.MAX_VALUE,z:Number.MAX_VALUE},max:{x:Number.MIN_VALUE,y:Number.MIN_VALUE,z:Number.MIN_VALUE},center:{x:0,y:0,z:0},radius:0}};Structure.RIGHT_HANDED_ALPHA=1,Structure.RIGHT_HANDED_OMEGA=2,Structure.RIGHT_HANDED_PI=3,Structure.RIGHT_HANDED_GAMMA=4,Structure.RIGHT_HANDED_3_10=5,Structure.LEFT_HANDED_ALPHA=6,Structure.LEFT_HANDED_OMEGA=7,Structure.LEFT_HANDED_GAMMA=8,Structure.RIBBON_HELIX_2_7=9,Structure.POLYPROLINE=10,Structure.threeToOne={ALA:"A",ARG:"R",ASN:"N",ASP:"D",CYS:"C",GLU:"E",GLN:"Q",GLY:"G",HIS:"H",ILE:"I",LEU:"L",LYS:"K",MET:"M",PHE:"F",PRO:"P",SER:"S",THR:"T",TRP:"W",TYR:"Y",VAL:"V",SEC:"U",PYL:"O",ASX:"B",GLX:"Z",XLE:"J",XAA:"X",XXX:"X"},Structure.prototype.setTitle=function(a){this.title=a},Structure.prototype.finder=function(a,b){return"ATOM"===a?this.atoms.filter(b):this.bonds.filter(b)},Structure.prototype.atomFinder=function(a){return this.atoms.filter(a)},Structure.prototype.bondFinder=function(a){return this.bonds.filter(a)},Structure.prototype.fasta=function(){for(var a="> "+this.ID+":"+this.atoms[0].chain+" | "+this.title+"\n",b=this.atoms[0].chainID,c=0,d=0;d<this.atoms.length;d++)this.atoms[d].chainID!=b&&(a+="\n> "+this.ID+":"+this.atoms[d].chain+" | "+this.title+"\n",b=this.atoms[d].chainID,c=0),"CA"===this.atoms[d].name&&this.atoms[d].chainID==b&&(a+=Structure.threeToOne[this.atoms[d].group],c++,c%80==0&&(a+="\n",c=0));return a},Structure.prototype.secondary=function(){for(var a="> "+this.ID+":"+this.atoms[0].chain+" | "+this.title+"\n",b=this.atoms[0].chainID,c=0,d=0;d<this.atoms.length;d++)this.atoms[d].chainID!=b&&(a+="\n> "+this.ID+":"+this.atoms[d].chain+" | "+this.title+"\n",b=this.atoms[d].chainID,c=0),"CA"===this.atoms[d].name&&this.atoms[d].chainID==b&&(a+=this.atoms[d].struct[0],c++,c%80==0&&(a+="\n",c=0));return a},Structure.prototype.toString=function(){var a="{\n";for(var b in this.atoms)a+="{",a+="type: '"+this.atoms[b].type+"', serial: "+this.atoms[b].serial+", name: '"+this.atoms[b].name+"', struct:'"+this.atoms[b].struct+"', x :"+this.atoms[b].x+", y :"+this.atoms[b].y+", z :"+this.atoms[b].z+", symbol:'"+this.atoms[b].symbol+"'},\n ";return a+="center: {"+this.cg.x+",y: "+this.cg.y+",z: "+this.cg.z+"} } ",a+="}\n"};var symbols={_:{symbol:"",unknown:180,vdwRadius:360,value2:12,name:"",color:[255,20,147]},H:{symbol:"H",unknown:80,vdwRadius:275,value2:4,name:"HYDROGEN",color:[255,20,147]},HE:{symbol:"He",unknown:400,vdwRadius:550,value2:5,name:"HELIUM",color:[255,192,203]},LI:{symbol:"Li",unknown:170,vdwRadius:305,value2:14,name:"LITHIUM",color:[255,20,147]},BE:{symbol:"Be",unknown:88,vdwRadius:157,value2:12,name:"BERYLLIUM",color:[255,20,147]},B:{symbol:"B",unknown:208,vdwRadius:387,value2:13,name:"BORON",color:[0,255,0]},C:{symbol:"C",unknown:180,vdwRadius:387,value2:0,name:"CARBON",color:[255,20,147]},N:{symbol:"N",unknown:170,vdwRadius:350,value2:1,name:"NITROGEN",color:[255,20,147]},O:{symbol:"O",unknown:170,vdwRadius:337,value2:2,name:"OXYGEN",color:[255,20,147]},F:{symbol:"F",unknown:160,vdwRadius:325,value2:6,name:"FLUORINE",color:[255,20,147]},N:{symbol:"N",unknown:280,vdwRadius:505,value2:12,name:"NEON",color:[255,20,147]},NA:{symbol:"Na",unknown:243,vdwRadius:550,value2:7,name:"SODIUM",color:[255,20,147]},MG:{symbol:"Mg",unknown:275,vdwRadius:375,value2:15,name:"MAGNESIUM",color:[255,20,147]},AL:{symbol:"Al",unknown:338,vdwRadius:375,value2:9,name:"ALUMINIUM",color:[255,20,147]},SI:{symbol:"Si",unknown:300,vdwRadius:550,value2:6,name:"SILICON",color:[255,20,147]},P:{symbol:"P",unknown:259,vdwRadius:470,value2:8,name:"PHOSPHORUS",color:[255,165,0]},S:{symbol:"S",unknown:255,vdwRadius:452,value2:3,name:"SULPHUR",color:[255,200,50]},CL:{symbol:"Cl",unknown:250,vdwRadius:437,value2:13,name:"CHLORINE",color:[0,255,0]},AR:{symbol:"Ar",unknown:392,vdwRadius:692,value2:12,name:"ARGON",color:[255,20,147]},K:{symbol:"K",unknown:332,vdwRadius:597,value2:12,name:"POTASSIUM",color:[255,20,147]},CA:{symbol:"Ca",unknown:248,vdwRadius:487,value2:9,name:"CALCIUM",color:[255,20,147]},SC:{symbol:"Sc",unknown:360,vdwRadius:330,value2:12,name:"SCANDIUM",color:[255,20,147]},TI:{symbol:"Ti",unknown:368,vdwRadius:487,value2:9,name:"TITANIUM",color:[255,20,147]},V:{symbol:"V",unknown:332,vdwRadius:265,value2:12,name:"VANADIUM",color:[255,20,147]},CR:{symbol:"Cr",unknown:338,vdwRadius:282,value2:9,name:"CHROMIUM",color:[255,20,147]},MN:{symbol:"Mn",unknown:338,vdwRadius:297,value2:9,name:"MANGANESE",color:[255,20,147]},FE:{symbol:"Fe",unknown:335,vdwRadius:487,value2:8,name:"IRON",color:[255,20,147]},CO:{symbol:"Co",unknown:332,vdwRadius:282,value2:12,name:"COBALT",color:[255,20,147]},NI:{symbol:"Ni",unknown:405,vdwRadius:310,value2:10,name:"NICKEL",color:[255,20,147]},CU:{symbol:"Cu",unknown:380,vdwRadius:287,value2:10,name:"COPPER",color:[255,20,147]},ZN:{symbol:"Zn",unknown:362,vdwRadius:287,value2:10,name:"ZINC",color:[255,20,147]},GA:{symbol:"Ga",unknown:305,vdwRadius:387,value2:12,name:"GALLIUM",color:[255,20,147]},GE:{symbol:"Ge",unknown:292,vdwRadius:999,value2:12,name:"GERMANIUM",color:[255,20,147]},AS:{symbol:"As",unknown:302,vdwRadius:207,value2:12,name:"ARSENIC",color:[255,20,147]},SE:{symbol:"Se",unknown:305,vdwRadius:225,value2:12,name:"SELENIUM",color:[255,20,147]},BR:{symbol:"Br",unknown:302,vdwRadius:437,value2:10,name:"BROMINE",color:[255,20,147]},KR:{symbol:"Kr",unknown:400,vdwRadius:475,value2:12,name:"KRYPTON",color:[255,20,147]},RB:{symbol:"Rb",unknown:368,vdwRadius:662,value2:12,name:"RUBIDIUM",color:[255,20,147]},SR:{symbol:"Sr",unknown:280,vdwRadius:505,value2:12,name:"STRONTIUM",color:[255,20,147]},Y:{symbol:"Y",unknown:445,vdwRadius:402,value2:12,name:"YTTRIUM",color:[255,20,147]},ZR:{symbol:"Zr",unknown:390,vdwRadius:355,value2:12,name:"ZIRCONIUM",color:[255,20,147]},NB:{symbol:"Nb",unknown:370,vdwRadius:332,value2:12,name:"NIOBIUM",color:[255,20,147]},MO:{symbol:"Mo",unknown:368,vdwRadius:437,value2:12,name:"MOLYBDENUM",color:[255,20,147]},TC:{symbol:"Tc",unknown:338,vdwRadius:450,value2:12,name:"TECHNETIUM",color:[255,20,147]},RU:{symbol:"Ru",unknown:350,vdwRadius:300,value2:12,name:"RUTHENIUM",color:[255,20,147]},RH:{symbol:"Rh",unknown:362,vdwRadius:305,value2:12,name:"RHODIUM",color:[255,20,147]},PD:{symbol:"Pd",unknown:375,vdwRadius:360,value2:12,name:"PALLADIUM",color:[255,20,147]},AG:{symbol:"Ag",unknown:398,vdwRadius:387,value2:9,name:"SILVER",color:[255,20,147]},CD:{symbol:"Cd",unknown:422,vdwRadius:437,value2:12,name:"CADMIUM",color:[255,20,147]},IN:{symbol:"In",unknown:408,vdwRadius:362,value2:12,name:"INDIUM",color:[255,20,147]},SN:{symbol:"Sn",unknown:365,vdwRadius:417,value2:12,name:"TIN",color:[255,20,147]},SB:{symbol:"Sb",unknown:365,vdwRadius:280,value2:12,name:"ANTIMONY",color:[255,20,147]},TE:{symbol:"Te",unknown:368,vdwRadius:315,value2:12,name:"TELLURIUM",color:[255,20,147]},I:{symbol:"I",unknown:350,vdwRadius:437,value2:11,name:"IODINE",color:[255,20,147]},XE:{symbol:"Xe",unknown:425,vdwRadius:525,value2:12,name:"XENON",color:[255,20,147]},CS:{symbol:"Cs",unknown:418,vdwRadius:752,value2:12,name:"CAESIUM",color:[255,20,147]},BA:{symbol:"Ba",unknown:335,vdwRadius:602,value2:8,name:"BARIUM",color:[255,20,147]},LA:{symbol:"La",unknown:468,vdwRadius:457,value2:12,name:"LANTHANUM",color:[255,20,147]},CE:{symbol:"Ce",unknown:458,vdwRadius:465,value2:12,name:"CERIUM",color:[255,20,147]},PR:{symbol:"Pr",unknown:455,vdwRadius:405,value2:12,name:"PRASEODYMIUM",color:[255,20,147]},ND:{symbol:"Nd",unknown:452,vdwRadius:447,value2:12,name:"NEODYMIUM",color:[255,20,147]},PM:{symbol:"Pm",unknown:450,vdwRadius:440,value2:12,name:"PROMETHIUM",color:[255,20,147]},SM:{symbol:"Sm",unknown:450,vdwRadius:435,value2:12,name:"SAMARIUM",color:[255,20,147]},EU:{symbol:"Eu",unknown:498,vdwRadius:490,value2:12,name:"EUROPIUM",color:[255,20,147]},GD:{symbol:"Gd",unknown:448,vdwRadius:422,value2:12,name:"GADOLINIUM",color:[255,20,147]},TD:{symbol:"Tb",unknown:440,vdwRadius:415,value2:12,name:"TERBIUM",color:[255,20,147]},DY:{symbol:"Dy",unknown:438,vdwRadius:407,value2:12,name:"DYSPROSIUM",color:[255,20,147]},HO:{symbol:"Ho",unknown:435,vdwRadius:402,value2:12,name:"HOLMIUM",color:[255,20,147]},ER:{symbol:"Er",unknown:432,vdwRadius:397,value2:12,name:"ERBIUM",color:[255,20,147]},TM:{symbol:"Tm",unknown:430,vdwRadius:392,value2:12,name:"THULIUM",color:[255,20,147]},YB:{symbol:"Yb",unknown:485,vdwRadius:385,value2:12,name:"YTTERBIUM",color:[255,20,147]},LU:{symbol:"Lu",unknown:430,vdwRadius:382,value2:12,name:"LUTETIUM",color:[255,20,147]},HF:{symbol:"Hf",unknown:392,vdwRadius:350,value2:12,name:"HAFNIUM",color:[255,20,147]},TA:{symbol:"Ta",unknown:358,vdwRadius:305,value2:12,name:"TANTALUM",color:[255,20,147]},W:{symbol:"W",unknown:342,vdwRadius:315,value2:12,name:"TUNGSTEN",color:[255,20,147]},RE:{symbol:"Re",unknown:338,vdwRadius:325,value2:12,name:"RHENIUM",color:[255,20,147]},OS:{symbol:"Os",unknown:342,vdwRadius:395,value2:12,name:"OSMIUM",color:[255,20,147]},IR:{symbol:"Ir",unknown:330,vdwRadius:305,value2:12,name:"IRIDIUM",color:[255,20,147]},PT:{symbol:"Pt",unknown:375,vdwRadius:387,value2:12,name:"PLATINUM",color:[255,20,147]},AU:{symbol:"Au",unknown:375,vdwRadius:362,value2:6,name:"GOLD",color:[255,20,147]},HG:{symbol:"Hg",unknown:425,vdwRadius:495,value2:12,name:"MERCURY",color:[255,20,147]},TL:{symbol:"Tl",unknown:388,vdwRadius:427,value2:12,name:"THALLIUM",color:[255,20,147]},PB:{symbol:"Pb",unknown:385,vdwRadius:540,value2:12,name:"LEAD",color:[255,20,147]},BI:{symbol:"Bi",unknown:385,vdwRadius:432,value2:12,name:"BISMUTH",color:[255,20,147]},PO:{symbol:"Po",unknown:420,vdwRadius:302,value2:12,name:"POLONIUM",color:[255,20,147]},AT:{symbol:"At",unknown:302,vdwRadius:280,value2:12,name:"ASTATINE",color:[255,20,147]},RN:{symbol:"Rn",unknown:475,vdwRadius:575,value2:12,name:"RADON",color:[255,20,147]},FR:{symbol:"Fr",unknown:450,vdwRadius:810,value2:12,name:"FRANCIUM",color:[255,20,147]},RA:{symbol:"Ra",unknown:358,vdwRadius:642,value2:12,name:"RADIUM",color:[255,20,147]},AC:{symbol:"Ac",unknown:295,vdwRadius:530,value2:12,name:"ACTINIUM",color:[255,20,147]},TH:{symbol:"Th",unknown:255,vdwRadius:460,value2:12,name:"THORIUM",color:[255,20,147]},PA:{symbol:"Pa",unknown:222,vdwRadius:400,value2:12,name:"PROTACTINIUM",color:[255,20,147]},U:{symbol:"U",unknown:242,vdwRadius:437,value2:12,name:"URANIUM",color:[255,20,147]},NP:{symbol:"Np",unknown:238,vdwRadius:427,value2:12,name:"NEPTUNIUM",color:[255,20,147]},PU:{symbol:"Pu",unknown:232,vdwRadius:417,value2:12,name:"PLUTONIUM",color:[255,20,147]},AM:{symbol:"Am",unknown:230,vdwRadius:415,value2:12,name:"AMERICIUM",color:[255,20,147]},CM:{symbol:"Cm",unknown:228,vdwRadius:412,value2:12,name:"CURIUM",color:[255,20,147]},BK:{symbol:"Bk",unknown:225,vdwRadius:410,value2:12,name:"BERKELIUM",color:[255,20,147]},CF:{symbol:"Cf",unknown:222,vdwRadius:407,value2:12,name:"CALIFORNIUM",color:[255,20,147]},ES:{symbol:"Es",unknown:220,vdwRadius:405,value2:12,name:"EINSTEINIUM",color:[255,20,147]},FM:{symbol:"Fm",unknown:218,vdwRadius:402,value2:12,name:"FERMIUM",color:[255,20,147]},MD:{symbol:"Md",unknown:215,vdwRadius:400,value2:12,name:"MENDELEVIUM",color:[255,20,147]},NO:{symbol:"No",unknown:212,vdwRadius:397,value2:12,name:"NOBELIUM",color:[255,20,147]},LR:{symbol:"Lr",unknown:210,vdwRadius:395,value2:12,name:"LAWRENCIUM",color:[255,20,147]}},groups={ALA:{"3code":"ALA","1code":"A",props:"01100100100010010"},ARG:{"3code":"ARG","1code":"R",props:"01001010010001101"},ASN:{"3code":"ASN","1code":"N",props:"01000000001011001"},ASP:{"3code":"ASP","1code":"D",props:"11000010001101001"},CYS:{"3code":"CYS","1code":"C",props:"01000100001011000"},"DA ":{"3code":"DA ","1code":"1",props:"000000000000000001010"}},PointStyle=function(a){this.structure=a.structure,this.context=a.context,this.VBO=null,this.isDirty=!0};PointStyle.prototype.getShape=function(){var a=null;return this.isDirty&&(this.createVBO(),a=new Shape,a.VBO=this.VBO),a},PointStyle.prototype.createGeometry=function(a){var b=[];for(var c in a.atoms)b.push(a.atoms[c].x),b.push(a.atoms[c].y),b.push(a.atoms[c].z);return new Float32Array(b)},PointStyle.prototype.createVBO=function(){var a=this.context,b=this.createGeometry(this.structure);this.VBO=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.VBO),a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW),this.VBO.itemSize=3,this.VBO.numItems=this.structure.atoms.length,this.isDirty=!1;
},EventManager.prototype.add=function(a,b){};